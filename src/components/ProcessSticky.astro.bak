---
const steps = [
  { id: 'step-1', title: 'Free Audit', body: 'We review your compliance & payroll risks.' },
  { id: 'step-2', title: 'Plan', body: 'Roadmap to clear dues & streamline filings.' },
  { id: 'step-3', title: 'Execute', body: 'We file, reconcile, and fix gaps.' },
  { id: 'step-4', title: 'Ongoing', body: 'Monthly filings, alerts & support.' },
];
---
<section class="process r" aria-label="Our process">
  <div class="wrap">
    <aside class="rail"><ol>{steps.map((s,i)=><li class={i===0?'active':''}><a href={`#${s.id}`}>{s.title}</a></li>)}</ol></aside>
    <div class="stages">{steps.map(s=>(<article id={s.id} class="stage"><h3>{s.title}</h3><p>{s.body}</p></article>))}</div>
  </div>
  <style>
    .wrap{display:grid;grid-template-columns:1fr;gap:20px}
    @media(min-width:960px){.wrap{grid-template-columns:260px 1fr}}
    .rail{position:sticky;top:96px;align-self:start}
    .rail ol{list-style:none;margin:0;padding:0;display:grid;gap:8px}
    .rail li{padding:8px 12px;border-left:3px solid transparent;opacity:.7}
    .rail li.active{border-color:currentColor;opacity:1;font-weight:600}
    .stages{display:grid;gap:clamp(32px,6vw,72px)}
  </style>
  <script is:inline>
    const items=[...document.querySelectorAll('.process .stage')];
    const io=new IntersectionObserver((es)=>{
      const vis=es.filter(e=>e.isIntersecting).sort((a,b)=>b.intersectionRatio-a.intersectionRatio)[0];
      if(!vis) return; const id=vis.target.id;
      document.querySelectorAll('.process .rail li').forEach(li=>{
        li.classList.toggle('active', li.querySelector('a')?.getAttribute('href')==='#'+id);
      });
    },{rootMargin:'-30% 0px -60% 0px',threshold:[0,.25,.5,.75,1]});
    items.forEach(n=>io.observe(n));
  </script>
</section>
