---
import BaseHead from '../../components/BaseHead.astro'
---
<html lang="en">
  <head>
    <BaseHead title="Compliance Calendar (.ics) | JCS World" />
  </head>
  <body>
    <main id="main-content" style="padding:2rem 1rem;max-width:900px;margin:auto">
      <h1 class="r">Compliance Calendar (.ics)</h1>
      <p class="r" style="opacity:.8">Generate recurring compliance reminders you can import into Google/Outlook.</p>
      <form class="r" id="gstForm" onsubmit="return false" style="display:grid;gap:1rem;margin:1rem 0">
        <div id="rows"></div>
        <button class="magnetic" id="add" type="button" style="padding:.6rem 1rem;border-radius:10px;border:1px solid rgba(0,0,0,.15)">Add Row</button>
        <button class="magnetic" id="dl" type="button" style="padding:.8rem 1rem;border-radius:10px;background:#111;color:#fff;border:none">Download .ics</button>
      </form>
      <p class="r" style="opacity:.65">Tip: Adjust reminders for weekends/holidays after import.</p>
    </main>
    <script>
      const rows = document.getElementById('rows');
      const addRow = (name='', day=10) => {
        const wrap = document.createElement('div');
        wrap.innerHTML = `
          <label>Title <input value="${name}" /></label>
          <label>Day of month <input type="number" min="1" max="31" value="${day}" /></label>`;
        wrap.style.display='grid'; wrap.style.gridTemplateColumns='2fr 1fr'; wrap.style.gap='.75rem';
        rows.appendChild(wrap);
      };
      addRow('GSTR-3B',20); addRow('GSTR-1',11); addRow('TDS',7);
      document.getElementById('add').addEventListener('click',()=>addRow());
      document.getElementById('dl').addEventListener('click', () => {
        const today = new Date();
        const lines = ['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//JCS World//Compliance Calendar//EN'];
        const months = 12;
        const uid = () => Math.random().toString(36).slice(2)+Date.now();
        rows.querySelectorAll('div').forEach((r) => {
          const [titleEl, dayEl] = r.querySelectorAll('input');
          const title = titleEl.value.trim() || 'Compliance';
          const day = Math.max(1, Math.min(31, parseInt(dayEl.value||1,10)));
          for(let m=0; m<months; m++){
            const d = new Date(today.getFullYear(), today.getMonth()+m, day, 9, 0, 0);
            const dt = d.toISOString().replace(/[-:]/g,'').split('.')[0] + 'Z';
            lines.push('BEGIN:VEVENT','UID:'+uid()+'@jcsworld.in','DTSTAMP:'+dt,'DTSTART:'+dt,'DTEND:'+dt,'SUMMARY:'+title,'DESCRIPTION:Auto-generated by JCS World Compliance Calendar','END:VEVENT');
          }
        });
        lines.push('END:VCALENDAR');
        const blob = new Blob([lines.join('\r\n')], {type:'text/calendar'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'jcsworld-compliance.ics'; a.click();
      });
    </script>
  </body>
</html>
